{% extends "base.html" %}

{% block title %}{{ law.title }} - Dose de Lei Di√°ria{% endblock %}

{% block head_extra %}
<style>
    /* Styles adapted for Dark Mode */
    .law-content-container {
        @apply bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md text-gray-800 dark:text-gray-300 leading-relaxed border border-blue-200 dark:border-gray-700;
        /* Prote√ß√£o contra sele√ß√£o de texto para c√≥pia (Preserved) */
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    /* Headings inside content - Inherit color or specify dark mode color */
    .law-content-container h1, .law-content-container h2, .law-content-container h3 {
        @apply mt-6 mb-2 font-semibold text-gray-700 dark:text-gray-200;
    }
    .law-content-container p {
        @apply mb-4;
    }
    .law-content-container ul, .law-content-container ol {
        @apply ml-6 mb-4;
    }
    .law-content-container li {
        @apply mb-2;
    }
    /* Ensure nested elements inherit dark mode text color */
    .law-content-container strong { @apply font-bold; }
    .law-content-container em { @apply italic; }
    .law-content-container u { @apply underline; }
    .law-content-container s { @apply line-through; }
    /* Quill background colors need dark mode equivalents if used */
    .ql-bg-yellow { background-color: yellow; } /* Consider dark mode alternative */
    .ql-bg-red { background-color: red; } /* Consider dark mode alternative */

    /* Banners adapted for Dark Mode */
    .completed-banner {
        @apply bg-green-100 text-green-700 dark:bg-green-800 dark:text-green-200 p-4 rounded-md mb-6 border border-green-200 dark:border-green-700;
    }
    .last-read-info {
        @apply bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200 p-3 px-4 rounded-md mb-6 border border-indigo-200 dark:border-indigo-700 text-sm;
    }
    /* Save Article Form adapted for Dark Mode */
    .save-article-form {
        @apply mt-6 p-4 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg;
    }
    .save-article-form label {
        @apply text-sm font-medium text-gray-700 dark:text-gray-300;
    }
    .save-article-form input[type="text"] {
        @apply shadow-sm appearance-none border border-gray-300 dark:border-gray-600 rounded-md py-1 px-2 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent w-24 bg-white dark:bg-gray-700;
    }
    .save-article-form button {
        @apply bg-indigo-500 hover:bg-indigo-600 dark:bg-indigo-600 dark:hover:bg-indigo-500 text-white font-medium py-1 px-3 rounded-md transition duration-300 text-sm;
    }
    /* Mark Complete Button adapted for Dark Mode */
    .mark-complete-button {
        @apply bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-500 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-lg shadow-md;
    }
</style>
{% endblock %}

{% block content %}
{# Adjusted flex container for better mobile layout #}
<div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 space-y-2 sm:space-y-0">
    {# Applied responsive text size and dark mode color #}
    <h1 class="text-xl md:text-2xl font-bold text-blue-700 dark:text-blue-400">{{ law.title }}</h1>
    {# Applied responsive text size, dark mode color, and whitespace-nowrap #}
    <a href="{{ url_for(\"student.dashboard\") }}" class="text-sm md:text-base text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300 whitespace-nowrap self-end sm:self-center">
        <i class="fas fa-arrow-left mr-1 md:mr-2"></i> Voltar ao Painel
    </a>
</div>

{% if is_completed %}
<div class="completed-banner" role="alert">
    <i class="fas fa-check-circle mr-2"></i> Voc√™ j√° concluiu esta legisla√ß√£o!
</div>
{% elif last_read_article %}
<div class="last-read-info" role="alert">
    <i class="fas fa-bookmark mr-2"></i> Voc√™ parou no artigo: <strong>{{ last_read_article }}</strong>
</div>
{% endif %}

<div class="law-content-container">
    {% if law.description %}
        {# Adapted text color for dark mode #}
        <p class="text-gray-600 dark:text-gray-400 italic mb-6">{{ law.description }}</p>
    {% endif %}
    
    {# Content should inherit dark mode text color from container #}
    {{ law.content | safe }}
</div>

{% if not is_completed %}
<!-- Save Last Read Article Form -->
<div class="save-article-form">
    <form action="{{ url_for(\"student.save_last_read\", law_id=law.id) }}" method="POST" class="flex items-center space-x-3">
        <label for="last_article">Parou no artigo n¬∫:</label>
        <input type="text" id="last_article" name="last_article" 
               placeholder="Ex: 15" value="{{ last_read_article or \'\' }}">
        <button type="submit">
            <i class="fas fa-save mr-1"></i> Salvar Posi√ß√£o
        </button>
    </form>
</div>

<!-- Mark as Complete Button -->
<div class="mt-8 text-center">
    <form action="{{ url_for(\"student.mark_complete\", law_id=law.id) }}" method="POST">
        <button type="submit" class="mark-complete-button">
            <i class="fas fa-check mr-2"></i> Marcar como Conclu√≠do
        </button>
    </form>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
{# Preserved original protection scripts #}
<script>
// üõ°Ô∏è PROTE√á√ïES DISCRETAS - APENAS C√ìPIA E IMPRESS√ÉO

// ‚úÖ Anti-impress√£o (Ctrl+P)
document.addEventListener(\'keydown\', function(e) {
    if (e.ctrlKey && (e.key === \'p\' || e.key === \'P\')) {
        e.preventDefault();
        e.stopPropagation();
        alert(\'Impress√£o n√£o permitida neste conte√∫do.\');
        return false;
    }
});

// ‚úÖ Anti-c√≥pia (Ctrl+C, Ctrl+A, Ctrl+X)
document.addEventListener(\'keydown\', function(e) {
    // Bloquear Ctrl+C (copiar)
    if (e.ctrlKey && (e.key === \'c\' || e.key === \'C\')) {
        e.preventDefault();
        e.stopPropagation();
        alert(\'C√≥pia de conte√∫do n√£o permitida.\');
        return false;
    }
    
    // Bloquear Ctrl+A (selecionar tudo)
    if (e.ctrlKey && (e.key === \'a\' || e.key === \'A\')) {
        e.preventDefault();
        e.stopPropagation();
        alert(\'Sele√ß√£o total n√£o permitida.\');
        return false;
    }
    
    // Bloquear Ctrl+X (recortar)
    if (e.ctrlKey && (e.key === \'x\' || e.key === \'X\')) {
        e.preventDefault();
        e.stopPropagation();
        alert(\'Recorte n√£o permitido.\');
        return false;
    }
});

// ‚úÖ Prote√ß√£o contra sele√ß√£o de texto
document.addEventListener(\'selectstart\', function(e) {
    e.preventDefault();
    return false;
});

// ‚úÖ Menu de contexto desabilitado (bot√£o direito)
document.addEventListener(\'contextmenu\', function(e) {
    e.preventDefault();
    alert(\'Menu de contexto desabilitado.\');
    return false;
});
</script>
{% endblock %}
